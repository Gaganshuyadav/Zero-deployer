
generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_DB_URL")
}

model User {
  id String @id @default(uuid())
  firstName String @db.VarChar(100) @map("first_name")
  lastName String? @db.VarChar(100) @map("last_name")
  email String @unique
  password String
  userRole UserRoleEnum? @map("user_role")
  project Project[]
}


model Project {
  id String @id @default(uuid())
  user User @relation(fields: [user_id], references: [id], onDelete: Cascade)
  user_id String
  name String
  createdBy String @map("created_by")
  gitUrl String @map("git_url")
  subDomain String @map("sub_domain")
  customDomain String @map("custom_domain")
  deployment Deployment[] 
  createdAt DateTime @map("created_at") @default(now())
  updatedAt DateTime @map("updated_at") @updatedAt
}

model Deployment {
  id String @id @default(uuid())
  project Project @relation( fields: [project_id], references: [id], onDelete: Cascade)
  project_id String
  status DeploymentStatusEnum
  createdAt DateTime @map("created_at") @default(now())
  updatedAt DateTime @map("updated_at") @updatedAt
}

model log_events{

  event_id String @id @default(uuid())
  user_id String
  project_id String
  deployment_id String

  log_level LogLevelEnum
  message String

  source SourceEnum
  container_id String 
  host String

  event_time DateTime @default(now())

}


// CREATE TABLE log_events
// (
//     user_id        UUID,
//     project_id     UUID,
//     deployment_id  UUID,

//     log_level Enum8(
//         'INFO'  = 1,
//         'WARN'  = 2,
//         'ERROR' = 3,
//         'DEBUG' = 4
//     ) DEFAULT 'INFO',

//     message        String,

//     source Enum8(
//         'container' = 1,
//         'build'     = 2,
//         'runtime'   = 3,
//         'system'    = 4
//     ) DEFAULT 'container',

//     container_id   Nullable(String),
//     host           Nullable(String),

//     event_time     DateTime64(3, 'UTC') DEFAULT now64(3),
//     event_id       UUID
// )
// ENGINE = MergeTree
// PARTITION BY toYYYYMM(event_time)
// ORDER BY (project_id, deployment_id, event_time)
// SETTINGS index_granularity = 8192;




// const logEvent = {
//     event_id: crypto.randomUUID(),        // uniqueness
//     user_id: process.env.USER_ID,
//     project_id: process.env.PROJECT_ID,
//     deployment_id: process.env.REPO_ID,

//     log_level: level,
//     message,

//     source: 'build',
//     container_id: process.env.HOSTNAME,   // ECS sets this
//     host: os.hostname(),

//     event_time: new Date().toISOString()
//   };





//enums:-

enum DeploymentStatusEnum {
  IN_ACTIVE
  QUEUED
  IN_PROGRESS
  DEPLOYED
  FAILED
  PAUSED
  STOPPED
}

enum LogLevelEnum {
  DEBUG
  INFO
  WARN
  ERROR
  FATAL
}

enum SourceEnum {
  CONTAINER
  BUILD 
  RUNTIME
  SYSTEM
}

enum UserRoleEnum {
  Admin
  User
}